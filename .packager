# -*- mode: ruby -*-
# -*- encoding: utf-8 -*-

Packager.build do
  ubuntu do
    target do
      platform 'ubuntu'
      version '14.04'
      package 'deb'
    end
    dependencies do
      build [
        'autoconf',
        'automake',
        'bison',
        'build-essential',
        'curl',
        'libc6-dev',
        'libcurl4-openssl-dev',
        'libffi-dev',
        'libreadline-dev',
        'libreadline6',
        'libreadline6-dev',
        'libsqlite3-dev',
        'libssl-dev',
        'libtool',
        'libxml2-dev',
        'libxslt1-dev',
        'libyaml-dev',
        'ncurses-dev',
        'openssl',
        'patch',
        'pkg-config',
        'python-software-properties',
        'sqlite3',
        'wget',
        'zlib1g',
        'zlib1g-dev'
      ]
      runtime [
        'libstdc++6',
        'libc6',
        'libffi6',
        'libgdbm3',
        'libncurses5',
        'libreadline6',
        'libssl0.9.8',
        'libyaml-0-2',
        'zlib1g'
      ]
    end
    build do
      name 'heavywater-ruby'
      template :generic
      commands do
        build [
          'wget http://ftp.ruby-lang.org/pub/ruby/2.1/ruby-2.1.5.tar.gz',
          '/bin/tar -zxf ruby-2.1.5.tar.gz',
          'mv -f ruby-2.1.5/* .',
          'autoconf',
          './configure --prefix=/usr --disable-install-doc',
          'cpucores=`nproc` make -j `expr $cpucores - 1 \| 1`',
          'make install DESTDIR=$PKG_DIR',
          '/usr/bin/gem install bundler'
        ]
      end
    end
  end
end
